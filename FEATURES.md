# 功能特性索引 (FEATURES.md)

本文档提供了 EV Charger Simulator 所有功能特性的完整列表和使用说明。

---

## 📑 目录

- [充电桩管理](#充电桩管理)
- [脚本引擎](#脚本引擎)
- [用户界面](#用户界面)
- [协议支持](#协议支持)
- [数据持久化](#数据持久化)
- [高级功能](#高级功能)

---

## 🔌 充电桩管理

### 1. 添加充电桩

**功能描述**: 创建新的虚拟充电桩

**使用方法**:
1. 点击"添加充电桩"按钮
2. 填写充电桩信息
3. 保存并自动持久化

**相关文档**: [PERSISTENCE.md](PERSISTENCE.md)

### 2. 删除充电桩

**功能描述**: 删除不需要的充电桩

**使用方法**:
1. 点击充电桩行的删除按钮
2. 确认删除操作
3. 自动保存到配置文件

**注意事项**: 
- 删除前会停止充电桩运行
- 会清除关联的脚本信息

### 3. 修改充电桩配置

**功能描述**: 更新充电桩参数

**可配置项**:
- 充电桩名称
- 协议类型（OCPP / 云快充）
- 服务器地址
- 最大功率
- 启用状态

**使用方法**:
1. 点击充电桩行的参数按钮
2. 修改配置
3. 保存并自动重启（如果正在运行）

**相关文档**: [PERSISTENCE.md](PERSISTENCE.md)

### 4. 批量创建充电桩

**功能描述**: 通过配置文件快速创建多个充电桩

**配置方式**:
```json
{
  "batch_config": {
    "enabled": true,
    "count": 100,
    "id_prefix": "CP",
    "name_prefix": "充电桩",
    "start_index": 1
  }
}
```

**适用场景**:
- 压力测试
- 大规模模拟
- 快速环境搭建

### 5. 查看充电桩状态

**功能描述**: 实时查看充电桩运行状态

**显示信息**:
- 连接状态（已连接/未连接）
- 运行状态（Available, Charging, Faulted等）
- 脚本状态（运行中/已停止）
- 当前功率（kW）
- 累计电量（kWh）
- 最后更新时间

**时间格式**: YYYY-MM-DD HH:mm:ss (本地时区)

**相关文档**: [TIME_FORMAT_FIX.md](TIME_FORMAT_FIX.md)

### 6. 展开详细信息

**功能描述**: 查看充电桩完整详情

**详细信息**:
- 会话 ID
- 错误代码
- 协议类型
- 最大功率
- 脚本信息
- 最近执行结果

**使用方法**: 点击充电桩行展开

---

## 🎮 脚本引擎

### 1. 配置脚本

**功能描述**: 为充电桩配置自动化脚本

**支持方式**:
- 选择预设脚本
- 编写自定义脚本

**预设脚本**:
1. **basic_test.js** - 基础功能测试
2. **normal_charging.js** - 正常充电流程
3. **fast_charging.js** - 快速充电流程
4. **fault_test.js** - 故障测试场景

**使用方法**:
1. 点击脚本配置按钮
2. 选择或编写脚本
3. 设置自动启动选项
4. 保存配置

**相关文档**: 
- [docs/SCRIPT_API.md](docs/SCRIPT_API.md)
- [SCRIPT_ENGINE_STATUS.md](SCRIPT_ENGINE_STATUS.md)

### 2. 启动/停止脚本

**功能描述**: 手动控制脚本执行

**操作按钮**:
- 启动脚本: 开始执行配置的脚本
- 停止脚本: 中断正在运行的脚本

**状态反馈**:
- 实时显示运行状态
- 显示执行结果（成功/失败）
- 显示错误信息

### 3. 自动启动脚本

**功能描述**: 充电桩连接成功后自动运行脚本

**配置方法**:
1. 在脚本配置中启用"自动启动"
2. 充电桩连接后自动执行

**适用场景**:
- 自动化测试
- 无人值守模拟
- 批量测试场景

### 4. 脚本 API

**可用操作**:
```javascript
// 获取充电桩对象
const charger = Deno.core.ops.op_get_charger();

// 充电控制
await charger.start_charging();
await charger.stop_charging();
await charger.set_power(power);

// 状态查询
const status = await charger.get_status();
const power = await charger.get_power();
const energy = await charger.get_energy();
```

**相关文档**: [docs/SCRIPT_API.md](docs/SCRIPT_API.md)

---

## 🎨 用户界面

### 1. 主题切换

**功能描述**: 在亮色和暗色主题间切换

**切换方式**: 点击右上角主题开关

**自动保存**: 主题选择自动保存到 localStorage

**适配范围**:
- Header（头部）
- Content（内容区）
- Card（卡片）
- Table（表格）
- Footer（页脚）
- Modal（对话框）

**相关文档**: 
- [THEME_SWITCHING.md](THEME_SWITCHING.md)
- [THEME_TEST.md](THEME_TEST.md)

### 2. 窗口记忆

**功能描述**: 自动保存和恢复窗口位置和大小

**保存内容**:
- 窗口位置（X, Y 坐标）
- 窗口大小（宽度、高度）
- 窗口状态（最大化/正常）

**存储位置**: 系统配置目录

**特性**:
- 关闭后重新打开自动恢复
- 多显示器支持
- 最大化状态记忆

### 3. 统计面板

**功能描述**: 实时显示充电桩统计数据

**统计指标**:
- 总桩数
- 在线数量
- 充电中数量
- 总充电功率

**更新频率**: 实时更新（1秒）

### 4. 数据表格

**功能特性**:
- 分页显示（10/20/50/100条）
- 排序功能
- 展开详情
- 固定表头
- 响应式列宽

**表格列**:
1. 充电桩ID
2. 连接状态
3. 运行状态
4. 脚本状态
5. 当前功率
6. 累计电量
7. 最后更新时间
8. 操作

### 5. 快速操作

**功能描述**: 常用操作快捷入口

**操作按钮**:
- 启动所有模拟
- 停止所有模拟
- 重置
- 添加充电桩
- 测试脚本引擎

### 6. 使用说明

**功能描述**: 内置的快速上手指南

**包含步骤**:
1. 添加充电桩
2. 配置参数
3. 配置脚本
4. 启动模拟
5. 切换主题

**提示内容**:
- 功能说明
- 操作技巧
- 注意事项

---

## 🔌 协议支持

### 1. OCPP 1.6J

**功能描述**: 标准开放充电点协议

**支持消息**:
- BootNotification
- Heartbeat
- StatusNotification
- StartTransaction
- StopTransaction
- MeterValues
- Authorize
- DataTransfer

**连接方式**: WebSocket

**服务器地址示例**: `ws://localhost:8080/ocpp`

**相关文档**: 
- [docs/OCPP_IMPLEMENTATION.md](docs/OCPP_IMPLEMENTATION.md)
- [OCPP_PROGRESS.md](OCPP_PROGRESS.md)

### 2. 云快充协议

**功能描述**: 国内云快充平台协议

**协议类型**: YunKuaiChong

**服务器地址示例**: `https://api.yunkuaichong.com`

**状态**: 部分支持

---

## 💾 数据持久化

### 1. 配置自动保存

**功能描述**: 所有配置修改自动保存

**保存时机**:
- 添加充电桩后
- 删除充电桩后
- 修改配置后

**保存位置**: `config/chargers.json`

**保存内容**:
- 充电桩配置列表
- 批量配置参数

**相关文档**: [PERSISTENCE.md](PERSISTENCE.md)

### 2. 配置自动加载

**功能描述**: 应用启动时自动加载配置

**加载流程**:
1. 读取配置文件
2. 创建充电桩实例
3. 恢复运行状态

**配置优先级**:
1. 环境变量 `CHARGER_CONFIG_PATH`
2. `config/chargers.json`
3. 默认配置

### 3. 主题配置保存

**功能描述**: 主题选择持久化

**保存位置**: `localStorage['theme-mode']`

**保存值**:
- `'dark'` - 暗色模式
- `'light'` - 亮色模式

**特性**: 跨会话保持

### 4. 窗口状态保存

**功能描述**: 窗口位置和大小持久化

**保存位置**: 系统配置目录

**特性**: 
- 自动保存
- 自动恢复
- 多显示器支持

---

## 🚀 高级功能

### 1. 批量控制

**功能描述**: 同时控制多个充电桩

**支持操作**:
- 启动所有模拟
- 停止所有模拟
- 重置所有

**适用场景**:
- 压力测试
- 批量操作
- 快速清理

### 2. 实时刷新

**功能描述**: 自动刷新充电桩状态

**刷新间隔**: 1秒（可调整）

**刷新内容**:
- 连接状态
- 运行状态
- 功率和电量
- 脚本状态

**控制方式**: 
- 自动刷新开关
- 手动刷新按钮

### 3. 分页显示

**功能描述**: 大数据量分页显示

**页面大小选项**:
- 10条/页
- 20条/页
- 50条/页
- 100条/页

**导航功能**:
- 首页
- 上一页
- 下一页
- 末页
- 跳转到指定页

### 4. 错误处理

**功能描述**: 完善的错误处理机制

**错误提示**:
- 操作失败提示
- 网络错误提示
- 配置错误提示

**错误恢复**:
- 自动重试
- 降级处理
- 状态恢复

### 5. 日志记录

**功能描述**: 完整的日志记录

**日志级别**:
- INFO
- WARN
- ERROR

**日志内容**:
- 系统启动
- 充电桩操作
- 脚本执行
- 错误信息

### 6. 响应式设计

**功能描述**: 适配不同屏幕尺寸

**支持分辨率**:
- 桌面端（≥1920px）
- 笔记本（1366px - 1920px）
- 平板（768px - 1366px）
- 手机（<768px）

**优化项**:
- 布局自适应
- 字体缩放
- 按钮大小调整

---

## 📊 性能特性

### 1. 高性能

**技术优势**:
- Rust 后端，低资源占用
- 异步处理，高并发
- WebSocket 长连接

**性能指标**:
- 支持同时模拟数百个充电桩
- 内存占用低
- CPU 占用低

### 2. 优化策略

**UI 优化**:
- 虚拟滚动（大数据）
- 防抖/节流
- 按需渲染

**数据优化**:
- 增量更新
- 本地缓存
- 压缩传输

### 3. 可扩展性

**架构设计**:
- 模块化架构
- 插件化设计
- 协议可扩展

**扩展能力**:
- 支持新协议
- 支持新脚本
- 支持新功能

---

## 🔍 查找功能

需要快速找到某个功能？使用以下索引：

### 按操作类型

- **增加**: [添加充电桩](#添加充电桩), [批量创建](#批量创建充电桩)
- **删除**: [删除充电桩](#删除充电桩)
- **修改**: [修改配置](#修改充电桩配置), [配置脚本](#配置脚本)
- **查询**: [查看状态](#查看充电桩状态), [展开详情](#展开详细信息)
- **控制**: [启动/停止](#启动停止脚本), [批量控制](#批量控制)

### 按功能模块

- **充电桩管理**: [充电桩管理](#充电桩管理)
- **脚本自动化**: [脚本引擎](#脚本引擎)
- **界面操作**: [用户界面](#用户界面)
- **协议通信**: [协议支持](#协议支持)
- **数据存储**: [数据持久化](#数据持久化)

### 按使用场景

- **首次使用**: [添加充电桩](#添加充电桩), [使用说明](#使用说明)
- **日常操作**: [启动模拟](#启动模拟), [查看状态](#查看充电桩状态)
- **批量测试**: [批量创建](#批量创建充电桩), [批量控制](#批量控制)
- **自动化测试**: [配置脚本](#配置脚本), [自动启动](#自动启动脚本)
- **个性化**: [主题切换](#主题切换), [窗口记忆](#窗口记忆)

---

## 📝 相关文档

- [README.md](README.md) - 项目总览
- [README_EXTENDED.md](README_EXTENDED.md) - 扩展文档
- [PERSISTENCE.md](PERSISTENCE.md) - 持久化功能
- [THEME_SWITCHING.md](THEME_SWITCHING.md) - 主题切换
- [docs/SCRIPT_API.md](docs/SCRIPT_API.md) - 脚本 API

---

**最后更新**: 2025-10-02
